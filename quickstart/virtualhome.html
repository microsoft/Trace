
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ü§Ø Finally: Emergent Behaviors &#8212; Trace</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/compatibility.css?v=fb730901" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script data-domain="microsoft.github.io/trace" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'quickstart/virtualhome';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Basics" href="../tutorials/basic_tutorial.html" />
    <link rel="prev" title="üöÄ Next: Adaptive Agent" href="quick_start_2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/trace_logo.png" class="logo__image only-light" alt="Trace - Home"/>
    <script>document.write(`<img src="../_static/trace_logo.png" class="logo__image only-dark" alt="Trace - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    üéØ Trace
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">üí°Quick Start</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">üåê  Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">‚ö°Ô∏è First: 5-Minute Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start_2.html">üöÄ Next: Adaptive Agent</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">ü§Ø Finally: Emergent Behaviors</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üìöTutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/basic_tutorial.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/optimization_tutorial.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/error_handling_tutorial.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/custom_optimizers.html">Building Custom Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/minibatch.html">Batch Optimization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Agent Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../examples/game/battleship.html">Single Agent: Battleship</a></li>


<li class="toctree-l1"><a class="reference internal" href="../examples/game/negotiation_arena.html">Multi-Agent: Negotiation Arena</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NLP Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../examples/nlp/bigbench_hard.html">BigBench-Hard</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Robotics Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../examples/robotics/metaworld.html">Meta-World</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">FAQ</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üìñ API Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/opto.html">opto</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/opto.optimizers.html">opto.optimizers</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.optimizers.buffers.html">opto.optimizers.buffers</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.buffers.FIFOBuffer.html">opto.optimizers.buffers.FIFOBuffer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.optimizers.opro.html">opto.optimizers.opro</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.opro.OPRO.html">opto.optimizers.opro.OPRO</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.optimizers.optimizer.html">opto.optimizers.optimizer</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optimizer.AbstractOptimizer.html">opto.optimizers.optimizer.AbstractOptimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optimizer.Optimizer.html">opto.optimizers.optimizer.Optimizer</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.optimizers.optoprime.html">opto.optimizers.optoprime</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optoprime.get_fun_name.html">opto.optimizers.optoprime.get_fun_name</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optoprime.node_to_function_feedback.html">opto.optimizers.optoprime.node_to_function_feedback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optoprime.repr_function_call.html">opto.optimizers.optoprime.repr_function_call</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optoprime.FunctionFeedback.html">opto.optimizers.optoprime.FunctionFeedback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optoprime.OptoPrime.html">opto.optimizers.optoprime.OptoPrime</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.optoprime.ProblemInstance.html">opto.optimizers.optoprime.ProblemInstance</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.optimizers.textgrad.html">opto.optimizers.textgrad</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.GRADIENT_MULTIPART_TEMPLATE.html">opto.optimizers.textgrad.GRADIENT_MULTIPART_TEMPLATE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.GRADIENT_OF_RESULTS_INSTRUCTION.html">opto.optimizers.textgrad.GRADIENT_OF_RESULTS_INSTRUCTION</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.construct_reduce_prompt.html">opto.optimizers.textgrad.construct_reduce_prompt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.construct_tgd_prompt.html">opto.optimizers.textgrad.construct_tgd_prompt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.get_short_value.html">opto.optimizers.textgrad.get_short_value</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.rm_node_attrs.html">opto.optimizers.textgrad.rm_node_attrs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.GradientInfo.html">opto.optimizers.textgrad.GradientInfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.textgrad.TextGrad.html">opto.optimizers.textgrad.TextGrad</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.optimizers.utils.html">opto.optimizers.utils</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.optimizers.utils.print_color.html">opto.optimizers.utils.print_color</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/opto.trace.html">opto.trace</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/opto.trace.stop_tracing.html">opto.trace.stop_tracing</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.broadcast.html">opto.trace.broadcast</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.broadcast.apply_op.html">opto.trace.broadcast.apply_op</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.broadcast.recursive_conversion.html">opto.trace.broadcast.recursive_conversion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/opto.trace.bundle.html">opto.trace.bundle</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.containers.html">opto.trace.containers</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.containers.trainable_method.html">opto.trace.containers.trainable_method</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.containers.Map.html">opto.trace.containers.Map</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.containers.NodeContainer.html">opto.trace.containers.NodeContainer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.containers.ParameterContainer.html">opto.trace.containers.ParameterContainer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.containers.Seq.html">opto.trace.containers.Seq</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.errors.html">opto.trace.errors</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.errors.ExecutionError.html">opto.trace.errors.ExecutionError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.errors.TraceMissingInputsError.html">opto.trace.errors.TraceMissingInputsError</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.iterators.html">opto.trace.iterators</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.iterators.iterate.html">opto.trace.iterators.iterate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.iterators.DictIterable.html">opto.trace.iterators.DictIterable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.iterators.SeqIterable.html">opto.trace.iterators.SeqIterable</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.modules.html">opto.trace.modules</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.modules.model.html">opto.trace.modules.model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.modules.Module.html">opto.trace.modules.Module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.nodes.html">opto.trace.nodes</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.get_op_name.html">opto.trace.nodes.get_op_name</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.node-function.html">opto.trace.nodes.node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.AbstractNode.html">opto.trace.nodes.AbstractNode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.ExceptionNode.html">opto.trace.nodes.ExceptionNode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.Graph.html">opto.trace.nodes.Graph</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.MessageNode.html">opto.trace.nodes.MessageNode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.Node.html">opto.trace.nodes.Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.NodeVizStyleGuide.html">opto.trace.nodes.NodeVizStyleGuide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.NodeVizStyleGuideColorful.html">opto.trace.nodes.NodeVizStyleGuideColorful</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.nodes.ParameterNode.html">opto.trace.nodes.ParameterNode</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.operators.html">opto.trace.operators</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.operators.identity.html">opto.trace.operators.identity</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.propagators.html">opto.trace.propagators</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.propagators.graph_propagator.html">opto.trace.propagators.graph_propagator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.propagators.propagators.html">opto.trace.propagators.propagators</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.trace.utils.html">opto.trace.utils</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.contain.html">opto.trace.utils.contain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.escape_json_nested_quotes.html">opto.trace.utils.escape_json_nested_quotes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.for_all_methods.html">opto.trace.utils.for_all_methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.parse_eqs_to_dict.html">opto.trace.utils.parse_eqs_to_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.remove_non_ascii.html">opto.trace.utils.remove_non_ascii</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.render_opt_step.html">opto.trace.utils.render_opt_step</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.sum_feedback.html">opto.trace.utils.sum_feedback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.trace.utils.test_json_quote_escaper.html">opto.trace.utils.test_json_quote_escaper</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/opto.utils.html">opto.utils</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../api/opto.utils.llm.html">opto.utils.llm</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.utils.llm.auto_construct_oai_config_list_from_env.html">opto.utils.llm.auto_construct_oai_config_list_from_env</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.utils.llm.AbstractModel.html">opto.utils.llm.AbstractModel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/opto.utils.llm.AutoGenLLM.html">opto.utils.llm.AutoGenLLM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/opto.version.html">opto.version</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/microsoft/Trace" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/quickstart/virtualhome.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ü§Ø Finally: Emergent Behaviors</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#virtualhome">üè† VirtualHome</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agent-architecture">Agent Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-agent-synchronous-optimization">Multi-Agent Synchronous Optimization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#emergent-pro-social-behaviors">Emergent Pro-Social Behaviors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recording-of-agent-behavior">Recording of Agent Behavior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">What‚Äôs Next?</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="finally-emergent-behaviors">
<h1>ü§Ø Finally: Emergent Behaviors<a class="headerlink" href="#finally-emergent-behaviors" title="Link to this heading">#</a></h1>
<p>In the previous two sections, we showed how to decorate Python functions for Trace to optimize and how to create an RL agent using Trace.
Now, we will demonstrate how Trace can be used to create interactive agents that learn emergent behaviors in a multi-agent environment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">opto.trace</span> <span class="k">as</span> <span class="nn">trace</span>
<span class="kn">from</span> <span class="nn">opto.trace</span> <span class="kn">import</span> <span class="n">node</span><span class="p">,</span> <span class="n">bundle</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">GRAPH</span>
<span class="kn">from</span> <span class="nn">opto.optimizers</span> <span class="kn">import</span> <span class="n">OptoPrime</span>
</pre></div>
</div>
<section id="virtualhome">
<h2>üè† VirtualHome<a class="headerlink" href="#virtualhome" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://virtual-home.org/">VirtualHome</a> is a Unity engine based simulation environment that creates a home-like environment where multiple agents need to collaboratively solve a
series of tasks, ranging from book reading, putting empty plates in a dishwasher, to preparing food.</p>
<img alt="virtual-home" class="align-center" src="../_images/virtualhome_image.png" />
<p>(Image credit: <a class="reference external" href="http://virtual-home.org/">Virtual Home Project Page</a>)</p>
<p>LLM agents have been observed to have ‚Äúnatural‚Äù organizational behavior in LLM-based agents when they were asked to have a few rounds of discussion, before carrying out the tasks in the environment (<a class="reference external" href="https://organized-llm-agents.netlify.app/">Prior work</a>).
However, it‚Äôs hard to determine whether the behavior of LLM agents is a result of emergence or if it‚Äôs due to inherent biases towards hierarchical organizational
behaviors because they are trained on human data.</p>
<p>In this section, we show that how to create multiple agents using Trace, and through optimization, we can observe emergent behaviors in these agents.
We first construct an agent.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>We can define a class that inherits from multiple other classes and still use <code class="docutils literal notranslate"><span class="pre">&#64;model</span></code> to decorate it and capture its behavior.</p>
</div>
<p>The observation of the agent and the action they can take in virtual home can be expressed in text. We follow the convention from <a class="reference external" href="https://arxiv.org/abs/2403.12482">Guo et al. (2024)</a>
with minor modifications and here is an example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>I&#39;m Agent_2. I&#39;m in a hurry to finish the housework with my friends Agent_1 together.
Given our shared goal, dialogue history, and my progress and previous actions,
please help me choose the best available action to achieve the goal as soon as possible.
Note that I can hold two objects at a time and there are no costs for holding objects.
All objects are denoted as &lt;name&gt; (id), such as &lt;table&gt; (712). Be aware that exploring
or checking the items in another room may cost some time to walk there.

Goal: Find and put 1 apple, 1 wine, 1 pudding onto the &lt;coffeetable&gt; (268).

Progress: This is step 0. I&#39;m holding nothing. I&#39;m in the bedroom, where I found an unchecked container &lt;cabinet&gt; (216). I don&#39;t know where Agent_1 is. The livingroom is unexplored. The kitchen is unexplored. The bathroom is unexplored.

Dialogue history:

Previous actions: [goexplore] &lt;bedroom&gt; (210)
Available actions:
A. [goexplore] &lt;livingroom&gt; (267)
B. [goexplore] &lt;kitchen&gt; (11)
C. [goexplore] &lt;bathroom&gt; (172)
D. [gocheck] &lt;cabinet&gt; (216)

Response format:
{&quot;thoughts&quot; : &quot;thoughts content&quot;,
&quot;action&quot; : &quot;choose one action from the available actions above&quot;}

Note: You must respond in the json format above. The action choice must be the same as one of the available actions.
If there&#39;s nothing left to do, the action can be &quot;None&quot;. If you choose [send_message], you must also generate the actual message.
</pre></div>
</div>
</section>
<section id="agent-architecture">
<h2>Agent Architecture<a class="headerlink" href="#agent-architecture" title="Link to this heading">#</a></h2>
<p>For the Trace optimized agent, we additionally add <code class="docutils literal notranslate"><span class="pre">Plan:$PLAN</span></code> right below <code class="docutils literal notranslate"><span class="pre">Goals</span></code>. The agent stores a plan in its python class object (which serves as its <strong>memory</strong>),
and when it needs to produce an action, it will replace <code class="docutils literal notranslate"><span class="pre">$PLAN$</span></code> with the current plan.
Trace optimizer will update the <strong>plan</strong> based on the feedback from the environment and the current progress.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">examples.virtualhome</span> <span class="kn">import</span> <span class="n">LLMCallable</span><span class="p">,</span> <span class="n">BaseUtil</span>

<span class="nd">@model</span>
<span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="n">LLMCallable</span><span class="p">,</span> <span class="n">BaseUtil</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plan</span> <span class="o">=</span> <span class="n">node</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">description</span><span class="o">=</span><span class="s2">&quot;This represents the current plan of the agent.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$PLAN$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plan</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="nd">@bundle</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the LLM to produce the next action for the agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_llm</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">available_actions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_actions</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">plan</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;action&#39;</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">plan</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="s1">&#39;[send_message]&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">action</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unify_and_match_action</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">available_actions</span><span class="p">)</span>

            <span class="c1"># if the matched failed, we randomly choose an action.</span>
            <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_actions</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">action</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">available_actions</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">action</span>
</pre></div>
</div>
</section>
<section id="multi-agent-synchronous-optimization">
<h2>Multi-Agent Synchronous Optimization<a class="headerlink" href="#multi-agent-synchronous-optimization" title="Link to this heading">#</a></h2>
<p>In a multi-agent environment, we can create multiple agents and let them interact with each other.
We take a synchronous approach, where all agents take actions after observing the current state of the environment, and their
actions are executed together. To make the simulation faster, we implement a sticky-action mechanism, where if the environment
observation is the same as the previous observation, we repeat the previous action without making another LLM call.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The full virtualhome environment requires Unity engine executable and is not included in the Trace package.
This code is for demo purposes only.</p>
</div>
<p>We first create two agents and their corresponding optimizers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">agent1</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">()</span>
<span class="n">agent2</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">()</span>

<span class="n">optimizer1</span> <span class="o">=</span> <span class="n">OptoPrime</span><span class="p">([</span><span class="n">agent1</span><span class="o">.</span><span class="n">plan</span><span class="p">])</span>
<span class="n">optimizer2</span> <span class="o">=</span> <span class="n">OptoPrime</span><span class="p">([</span><span class="n">agent2</span><span class="o">.</span><span class="n">plan</span><span class="p">])</span>

<span class="n">agents</span> <span class="o">=</span> <span class="p">[</span><span class="n">agent1</span><span class="p">,</span> <span class="n">agent2</span><span class="p">]</span>
</pre></div>
</div>
<p>We then run the simulation for a fixed number of steps. In each step, we observe the environment, and each agent produces an action based on its observation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">examples.virtualhome</span> <span class="kn">import</span> <span class="n">VirtualHomeEnv</span>

<span class="n">horizon</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">VirtualHomeEnv</span><span class="p">()</span>

<span class="c1"># we specify a task in this environment</span>
<span class="n">agent_obs</span><span class="p">,</span> <span class="n">agent_obs_descs</span><span class="p">,</span> <span class="n">agent_goal_specs</span><span class="p">,</span> <span class="n">agent_goal_descs</span><span class="p">,</span> <span class="n">agent_infos</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">horizon</span><span class="p">):</span>
    <span class="n">plans</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)):</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">agents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">agent</span><span class="p">(</span><span class="n">agent_obs_descs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">trace</span><span class="o">.</span><span class="n">ExecutionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">errors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
            <span class="n">plans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">step_info</span><span class="p">,</span> <span class="n">next_agent_obs_descs</span><span class="p">,</span> <span class="n">dict_actions</span><span class="p">,</span> <span class="n">dict_info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">plans</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">infos</span><span class="p">,</span> <span class="n">messages</span> <span class="o">=</span> <span class="n">step_info</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agents</span><span class="p">)):</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_feedback</span><span class="p">()</span>
        <span class="n">feedback</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Task Return: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">reward</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;reward&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step: </span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feedback: </span><span class="si">{</span><span class="n">feedback</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">next_agent_obs_descs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">feedback</span><span class="p">)</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># now we detach the graph for the next step</span>
        <span class="n">agent_obs_descs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_agent_obs_descs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we see an interesting case of optimization. In this environment, the observation an agent sees is the result of the agent‚Äôs previous action.
Therefore, we can directly call <code class="docutils literal notranslate"><span class="pre">backward</span></code> on the next observation.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To learn more about how to use Trace to create an agent in an interactive environment, check out the <a class="reference external" href="https://microsoft.github.io/Trace/examples/robotics/metaworld.html">Meta-World</a> example.</p>
</div>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h2>
<p>We compare with the baseline ReAct agents that only outputs <code class="docutils literal notranslate"><span class="pre">thoughts</span></code> before taking an action.
This table shows that when Trace optimizes and updates the plan of the agents, they can learn to coordinate with each other and achieve the shared goal more efficiently.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This figure is not to show that other style of agent architecture cannot achieve similar results.
We are using this example to demonstrate how easy it is to specify an RL agent using Trace and how Trace can optimize individual agents in a multi-agent environment.</p>
</div>
<img alt="task-reward" class="align-center" src="../_images/virtualhomes.png" />
<div class="align-center docutils">
<p>(<strong>Figure</strong>: <em>Lower number indicates faster task completion. We do not count sending a message as an action ‚Äì although if an action sends a message, it cannot perform another action in the same round.
The number of action describes the total number of actions from both agents.</em>)</p>
</div>
</section>
<section id="emergent-pro-social-behaviors">
<h2>Emergent Pro-Social Behaviors<a class="headerlink" href="#emergent-pro-social-behaviors" title="Link to this heading">#</a></h2>
<p>We also found out that Trace-optimized agents develop pro-social behaviors, under the optimization procedure.
The agents will learn to coordinate with each other to achieve the shared goal, but will choose not to communicate when they need to be more efficient.
Although there are many caveats to this toy experiment, emergence of behaviors through optimization can be achieved via Trace.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Click to reveal some optimized plans and actions<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><strong>Agent 2, Step 3</strong></p>
</div>
<div class="sd-card-body docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Plan</span> As I‚Äôm currently in the kitchen and have access to several unexplored kitchen cabinets, my strategy should be to first check the nearest kitchen cabinet (75) and proceed sequentially to optimize task completion time and reduce unnecessary movement.</p>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Action</span> Executing script: <code class="docutils literal notranslate"><span class="pre">&lt;character2&gt;</span> <span class="pre">[walktowards]</span> <span class="pre">&lt;kitchencabinet&gt;</span> <span class="pre">(77)</span></code></p>
</div>
</div>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><strong>Agent 2, Step 7</strong></p>
</div>
<div class="sd-card-body docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Plan</span> Since I‚Äôm in the kitchen with necessary items around and unchecked kitchen containers like <kitchencabinet> (79) and <kitchencabinet> (80) available, I should check these first and involve discussions with Agent_1 to decide if we should either explore further or require assistance in any tasks.</p>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Action</span> Executing script: <code class="docutils literal notranslate"><span class="pre">&lt;character2&gt;</span> <span class="pre">[send_message]</span> <span class="pre">&lt;Agent_1&gt;</span> <span class="pre">(1):</span> <span class="pre">Let's</span> <span class="pre">divide</span> <span class="pre">our</span> <span class="pre">search.</span> <span class="pre">Can</span> <span class="pre">you</span> <span class="pre">explore</span> <span class="pre">the</span> <span class="pre">bathroom</span> <span class="pre">while</span> <span class="pre">I</span> <span class="pre">check</span> <span class="pre">the</span> <span class="pre">fridge</span> <span class="pre">here</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">kitchen?</span></code></p>
</div>
</div>
<p class="sd-card-text">After a few more steps of searching and finding the necessary items, Agent 1 came up with a different plan.
Note that unfortunately Agent 1 doesn‚Äôt realize its own ‚Äúplan‚Äù cannot be read/accessed by Agent 2.</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><strong>Agent 1, Step 10</strong></p>
</div>
<div class="sd-card-body docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Plan</span> Since we‚Äôre both capable of handling two items and are already in the kitchen, let‚Äôs bypass extended communication and each take direct actions towards goal completion. Please <code class="docutils literal notranslate"><span class="pre">[gocheck]</span> <span class="pre">&lt;microwave&gt;</span> <span class="pre">(109)</span></code> for any plates, while I handle the <code class="docutils literal notranslate"><span class="pre">[&lt;stove&gt;</span> <span class="pre">(105)]</span></code>. This coordinated effort should swiftly meet our objective.</p>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Action</span> Executing script: <code class="docutils literal notranslate"><span class="pre">&lt;character1&gt;</span> <span class="pre">[walktowards]</span> <span class="pre">&lt;stove&gt;</span> <span class="pre">(105)</span></code></p>
</div>
</div>
<p class="sd-card-text">After finding all the items in the kitchen, some objects are still missing. Now the plan is to conduct a larger search.</p>
<div class="sd-card sd-sphinx-override sd-mb-3 sd-shadow-sm docutils">
<div class="sd-card-header docutils">
<p class="sd-card-text"><strong>Agent 2, Step 17</strong></p>
</div>
<div class="sd-card-body docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Plan</span> Given the current situation to find 1 cutleryfork and 2 plates, continue searching in the living room as it is still unexplored and this area might provide necessary items. With careful navigation and effective search, locate containers that might hide these kitchen items. If the living room doesn‚Äôt yield results, transition to the bedroom without further delays to continue the search.</p>
</div>
<div class="sd-card-footer docutils">
<p class="sd-card-text"><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">Action</span> Executing script: <code class="docutils literal notranslate"><span class="pre">&lt;character2&gt;</span> <span class="pre">[walktowards]</span> <span class="pre">&lt;livingroom&gt;</span> <span class="pre">(267)</span></code></p>
</div>
</div>
</div>
</details><p>We show that this pro-social behavior does not happen across all tasks. For example, in two other tasks ‚Äì <code class="docutils literal notranslate"><span class="pre">read</span> <span class="pre">book</span></code> and <code class="docutils literal notranslate"><span class="pre">prepare</span> <span class="pre">food</span></code> ‚Äì the agents do not communicate with each other at all.
This can be attributed to many reasons, but we will stop our investigation here.
When we optimize our agents through Trace, the emergent behaviors will change according to different tasks. This is very different from explicitly requiring the agent to communicate with each other.</p>
<img alt="messages" class="align-center" src="../_images/virtualhomes_messages.png" />
</section>
<section id="recording-of-agent-behavior">
<h2>Recording of Agent Behavior<a class="headerlink" href="#recording-of-agent-behavior" title="Link to this heading">#</a></h2>
<p>We show three videos of how Trace-optimized agents accomplished Task 2 (Put Dishwasher). We present the top-down birdseye view, and what each agent sees in their own perspective.</p>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-g-0 sd-g-xs-0 sd-g-sm-0 sd-g-md-0 sd-g-lg-0 docutils">
<div class="sd-col sd-d-flex-column docutils">
<figure class="align-default">
<img alt="../_images/task2.gif" src="../_images/task2.gif" />
</figure>
</div>
<div class="sd-col sd-d-flex-column docutils">
<figure class="align-default">
<img alt="../_images/agent1_task2.gif" src="../_images/agent1_task2.gif" />
</figure>
</div>
<div class="sd-col sd-d-flex-column docutils">
<figure class="align-default">
<img alt="../_images/agent2_task2.gif" src="../_images/agent2_task2.gif" />
</figure>
</div>
</div>
</div>
</section>
<section id="what-s-next">
<h2>What‚Äôs Next?<a class="headerlink" href="#what-s-next" title="Link to this heading">#</a></h2>
<p>In this tutorial, we showed how to create two agents and have them interact with each other in a multi-agent environment.
If you are interested in knowing how to use Trace for your own projects, continue learning the basics of Trace.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To learn more about how to trace through agent-environment interactions, check out the <a class="reference external" href="https://microsoft.github.io/Trace/examples/robotics/metaworld.html">Meta-World</a> example.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To see another example of multi-agent interaction in a different environment, check out the <a class="reference external" href="https://microsoft.github.io/Trace/examples/game/negotiation_arena.html">Negotiation Arena</a> example.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./quickstart"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="quick_start_2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">üöÄ Next: Adaptive Agent</p>
      </div>
    </a>
    <a class="right-next"
       href="../tutorials/basic_tutorial.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Basics</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#virtualhome">üè† VirtualHome</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agent-architecture">Agent Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-agent-synchronous-optimization">Multi-Agent Synchronous Optimization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#emergent-pro-social-behaviors">Emergent Pro-Social Behaviors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recording-of-agent-behavior">Recording of Agent Behavior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">What‚Äôs Next?</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ching-An Cheng, Allen Nie, Adith Swaminathan
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024 Trace Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <a href='mailto:chinganc@microsoft.com'>Contact Us</a> | <a href='http://go.microsoft.com/fwlink/?LinkId=521839'>Privacy &amp; Cookies</a> | <a href='https://go.microsoft.com/fwlink/?linkid=2259814'>Consumer Health Privacy</a> | <a href='https://go.microsoft.com/fwlink/?LinkID=206977'>Terms Of Use</a> | <a href='https://www.microsoft.com/trademarks'>Trademarks</a>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>